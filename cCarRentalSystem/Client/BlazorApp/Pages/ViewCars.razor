@page "/ViewCars"
@using Domain.Models
@using HttpClients.ClientInterfaces
@using Domain.DTOs
@inject ICarService carService;

<h3 style="text-align: center">View Cars</h3>

@if (!string.IsNullOrEmpty(msg))
{
    <div>
        <span>@msg</span>
    </div>
}

 @if (cars == null)
 {
    <span>Null...</span>
 }
 else if (!cars.Any())
 {
    <span>No cars to be found...</span>
 }
 else
 {
     <div class="cars-container">
         @foreach (var item in cars)
              {
                  <a href="/CarDetails/@item.Id" class="card">
                      <div class="row-col-6 d-flex justify-content-center">
                          <img src="logo-no-background.png" width="80%"/>
                      </div>
                      <div class="row-col-6 d-flex justify-content-center">
                          <label>@item.Brand</label>
                      </div>
                      <div class="row-col-6 d-flex justify-content-center">
                          <label>@item.Model</label>
                      </div>
                      
                      <label @onclick="@(() => RemoveCar(item.Id))" style="cursor:pointer; color: red; font-weight: bold">
                                              &#x2717;
                          </label>
                                      
                  </a>
              }
     </div>
 }

@code
{
 private IEnumerable<Car>? cars;
 private string msg = "";
 
 protected override async Task OnInitializedAsync()
     {
        try
        {
            SearchCarParametersDto dto = new SearchCarParametersDto(null, null, null, null, null, null, null, null, null, null);
             cars = await carService.GetCarsAsync(dto);
         }
         catch (Exception e)
         {
            msg = e.Message;
         }
     }
    
    private async Task RemoveCar(int carId)
    {
        msg="";
        try
        {
            await carService.DeleteAsync(carId);

            var list = new List<Car>(cars!);
            list.RemoveAll(car => car.Id == carId);
            cars= list.AsEnumerable();
        }
        catch (Exception e)
        {
            Console.WriteLine(e);
            throw;
        }
    }
}
